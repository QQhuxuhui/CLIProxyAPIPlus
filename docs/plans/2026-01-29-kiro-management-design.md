# Kiro è´¦å·ç®¡ç†åŠŸèƒ½è®¾è®¡

## æ¦‚è¿°

åœ¨ management.html çš„è®¤è¯æ–‡ä»¶ç®¡ç†æ¨¡å—ä¸­å¢å¼º Kiro ç±»å‹çš„å±•ç¤ºï¼Œæ”¯æŒæŸ¥çœ‹è´¦å·ä¿¡æ¯ã€ç”¨é‡/é…é¢ã€æ·»åŠ å’Œåˆ é™¤è´¦å·ã€‚

## éœ€æ±‚ç¡®è®¤

- **å±•ç¤ºæ–¹å¼**ï¼šç®€æ´å¡ç‰‡å¼ï¼Œæ•´åˆåˆ°ç°æœ‰è®¤è¯æ–‡ä»¶ç®¡ç†æ¨¡å—
- **è®¤è¯æ–¹å¼**ï¼šå¤ç”¨ `/v0/oauth/kiro` é¡µé¢ï¼ˆæ–°çª—å£è·³è½¬ï¼‰
- **Token åˆ·æ–°**ï¼šä»…æ˜¾ç¤ºçŠ¶æ€ï¼Œä¾èµ–ç³»ç»Ÿè‡ªåŠ¨åˆ·æ–°ï¼ˆä¸å…¶ä»–ç±»å‹ä¸€è‡´ï¼‰
- **ç”¨é‡è·å–**ï¼šæŒ‰éœ€è·å–ï¼ˆç‚¹å‡»å±•å¼€æ—¶è°ƒç”¨ APIï¼‰

## API è®¾è®¡

### æ–°å¢æ¥å£ï¼šè·å– Kiro ç”¨é‡

**ç«¯ç‚¹**ï¼š`GET /v0/management/kiro-usage`

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|-----|------|-----|------|
| `auth_index` | int | æ˜¯ | è®¤è¯æ–‡ä»¶ç´¢å¼• |

**æˆåŠŸå“åº”**ï¼š

```json
{
  "success": true,
  "data": {
    "email": "user@example.com",
    "subscription": "KIRO FREE",
    "usage": {
      "current": 150,
      "limit": 500,
      "percentage": 30.0
    },
    "reset": {
      "days_until": 15,
      "next_date": "2026-02-15T00:00:00Z"
    }
  }
}
```

**é”™è¯¯å“åº”**ï¼š

```json
{
  "success": false,
  "error": "token expired or invalid"
}
```

## åç«¯å®ç°

### æ–‡ä»¶ç»“æ„

```
internal/api/handlers/management/
â”œâ”€â”€ kiro_usage.go    # æ–°å¢ï¼šKiro ç”¨é‡æ¥å£
â””â”€â”€ ...
```

### å¤„ç†æµç¨‹

1. æ¥æ”¶è¯·æ±‚ï¼ŒéªŒè¯ `auth_index` å‚æ•°
2. ä» `authManager` è·å–å¯¹åº”çš„è®¤è¯å¯¹è±¡
3. éªŒè¯æ˜¯å¦ä¸º Kiro ç±»å‹
4. è°ƒç”¨ `GetUsageLimits` è·å–ç”¨é‡ä¿¡æ¯
5. æ ¼å¼åŒ–å“åº”æ•°æ®è¿”å›

### è·¯ç”±æ³¨å†Œ

åœ¨ `internal/api/server.go` ä¸­æ·»åŠ ï¼š

```go
mgmt.GET("/kiro-usage", s.mgmt.GetKiroUsage)
```

## å‰ç«¯è®¾è®¡

### Kiro å¡ç‰‡å±•ç¤º

**åŸºç¡€çŠ¶æ€ï¼ˆæœªå±•å¼€ï¼‰**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“§ user@example.com                     â”‚
â”‚ ç±»å‹: Kiro (AWS Builder ID)             â”‚
â”‚ çŠ¶æ€: â— æ´»è·ƒ                            â”‚
â”‚ æœ€ååˆ·æ–°: 2026-01-29 10:30              â”‚
â”‚                        [æŸ¥çœ‹ç”¨é‡ â–¼]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å±•å¼€çŠ¶æ€**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“§ user@example.com                     â”‚
â”‚ ç±»å‹: Kiro (AWS Builder ID)             â”‚
â”‚ çŠ¶æ€: â— æ´»è·ƒ                            â”‚
â”‚ æœ€ååˆ·æ–°: 2026-01-29 10:30              â”‚
â”‚                        [æŸ¥çœ‹ç”¨é‡ â–²]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¢é˜…è®¡åˆ’: KIRO FREE                     â”‚
â”‚ ç”¨é‡: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 150/500 (30%)    â”‚
â”‚ é‡ç½®æ—¶é—´: 15 å¤©å (2026-02-15)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠ è½½çŠ¶æ€**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“§ user@example.com                     â”‚
â”‚ ç±»å‹: Kiro (AWS Builder ID)             â”‚
â”‚ çŠ¶æ€: â— æ´»è·ƒ                            â”‚
â”‚ æœ€ååˆ·æ–°: 2026-01-29 10:30              â”‚
â”‚                        [æŸ¥çœ‹ç”¨é‡ â–²]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â³ æ­£åœ¨è·å–ç”¨é‡ä¿¡æ¯...           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é”™è¯¯çŠ¶æ€**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“§ user@example.com                     â”‚
â”‚ ç±»å‹: Kiro (AWS Builder ID)             â”‚
â”‚ çŠ¶æ€: â— æ´»è·ƒ                            â”‚
â”‚ æœ€ååˆ·æ–°: 2026-01-29 10:30              â”‚
â”‚                        [æŸ¥çœ‹ç”¨é‡ â–²]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ è·å–ç”¨é‡ä¿¡æ¯å¤±è´¥          [é‡è¯•]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ“ä½œåŠŸèƒ½

**æ·»åŠ  Kiro è´¦å·**ï¼š
- ç‚¹å‡»æŒ‰é’®ï¼Œæ–°çª—å£æ‰“å¼€ `/v0/oauth/kiro`
- è®¤è¯å®Œæˆååˆ·æ–°åˆ—è¡¨

**åˆ é™¤è´¦å·**ï¼š
- å¤ç”¨ `DELETE /v0/management/auth-files`

**ç¦ç”¨/å¯ç”¨**ï¼š
- å¤ç”¨ `PATCH /v0/management/auth-files/status`

## é”™è¯¯å¤„ç†

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|-----|---------|
| Token å·²è¿‡æœŸ | æ˜¾ç¤º"Token å·²è¿‡æœŸï¼Œè¯·é‡æ–°è®¤è¯"ï¼Œæä¾›é‡æ–°è®¤è¯æŒ‰é’® |
| ç½‘ç»œè¯·æ±‚å¤±è´¥ | æ˜¾ç¤º"è·å–ç”¨é‡ä¿¡æ¯å¤±è´¥"ï¼Œæä¾›é‡è¯•æŒ‰é’® |
| AWS API é™æµ | æ˜¾ç¤º"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"ï¼Œæä¾›é‡è¯•æŒ‰é’® |
| è´¦å·ä¸å­˜åœ¨ | æ˜¾ç¤º"è´¦å·ä¸å­˜åœ¨"ï¼Œè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨ |

### é‡è¯•æœºåˆ¶

- ç‚¹å‡»é‡è¯•æŒ‰é’®åï¼Œé‡æ–°è°ƒç”¨ `/v0/management/kiro-usage` æ¥å£
- é‡è¯•æ—¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
- è¿ç»­å¤±è´¥ 3 æ¬¡åï¼Œæç¤ºç”¨æˆ·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åå†è¯•

## ç¼“å­˜ç­–ç•¥

- æˆåŠŸè·å–ç”¨é‡ä¿¡æ¯åç¼“å­˜
- ç¼“å­˜èŒƒå›´ï¼šå½“å‰é¡µé¢ä¼šè¯
- é¡µé¢åˆ·æ–°æˆ–æ‰‹åŠ¨åˆ·æ–°æ—¶å¤±æ•ˆ
- é”™è¯¯ä¸ç¼“å­˜ï¼Œå…è®¸é‡è¯•

## å®ç°æ¸…å•

### åç«¯

| æ–‡ä»¶ | æ“ä½œ |
|-----|------|
| `internal/api/handlers/management/kiro_usage.go` | æ–°å¢ |
| `internal/api/server.go` | ä¿®æ”¹ï¼ˆæ³¨å†Œè·¯ç”±ï¼‰ |

### å‰ç«¯

| æ”¹åŠ¨ | è¯´æ˜ |
|-----|------|
| Kiro å¡ç‰‡ç»„ä»¶ | å¢åŠ å±•å¼€åŠŸèƒ½ |
| æ·»åŠ è´¦å·æŒ‰é’® | è·³è½¬åˆ°è®¤è¯é¡µé¢ |
| API è°ƒç”¨é€»è¾‘ | è°ƒç”¨ç”¨é‡æ¥å£ |
